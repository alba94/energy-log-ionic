<ion-header>
  <ion-toolbar>
    <ion-title class="ion-text-center">App food database management</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="loggedUserProfile">
  <form #f="ngForm">
    <ion-card class="card_main">

      <ion-grid>

        <!-- Row: 1 - Dropdown food item -->
        <ion-row>
          <ion-col>
            <ion-item>
              <ion-label position="floating">Pick food name...</ion-label>
              <ionic-selectable name="filterFoodItem" #filterSearchBar="ngModel" [(ngModel)]="filteredItem"
                [items]="foodItems" itemValueField="name" itemTextField="name"
                [canClear]="true" [canSearch]="true" [searchFailText]="'No food items were found.'"
                closeButtonSlot="end" [hasInfiniteScroll]="true"
                [required]="filterSearchBar.touched"
                (onChange)="onSelectionChanged(filteredItem)">

                <ng-template ionicSelectableCloseButtonTemplate>
                  <ion-icon name="close-circle"></ion-icon>
                </ng-template>
      
            </ionic-selectable>
            </ion-item>
          </ion-col>
        </ion-row>
        <ion-row *ngIf="filterSearchBar.hasError('required')">
          <ion-col>
            <ion-label color="danger"><ion-icon name="information-circle"></ion-icon>&nbsp;Field must not be empty.</ion-label>
          </ion-col>
        </ion-row>

        <!-- Row: 2 - Dropdown categories -->
        <ion-row>
          <ion-col offset-md="1">
            <ion-item>
              <ion-label position="floating">Choose food category</ion-label>
              <ion-select ngModel name="foodCategory" [required]="foodCategoryInput.touched" #foodCategoryInput="ngModel">
                <ion-select-option *ngFor="let catItem of foodCategories" [value]="catItem"
                  >{{ catItem.toUpperCase() }}
                </ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
          <!-- Input serving size -->
          <ion-col>
            <ion-item>
              <ion-label position="floating">Serving, gr</ion-label>
              <ion-input ngModel type="number" name="serving" [required]="servingInput.touched" [min]="minValue" #servingInput="ngModel"></ion-input>
            </ion-item>
          </ion-col>
        </ion-row>
        <!-- Error message -->
        <ion-row *ngIf="foodCategoryInput.hasError('required') && foodCategoryInput.touched || servingInput.hasError('required') && servingInput.touched">
          <ion-col offset-md="4">
            <ion-label color="danger"><ion-icon name="information-circle"></ion-icon>&nbsp;Field must not be empty.</ion-label>
          </ion-col>
        </ion-row>

        <!-- Row: 3 - Input serving fat, carbs, protein -->
        <ion-row>
          <ion-col offset-md="1">
            <ion-item>
              <ion-label position="floating">Fat, gr</ion-label>
              <ion-input ngModel type="number" name="fat" [required]="fatInput.touched" [min]="minValue" #fatInput="ngModel"></ion-input>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-item>
              <ion-label position="floating">Carbohydrate, gr</ion-label>
              <ion-input ngModel type="number" name="carb" [required]="carbInput.touched" [min]="minValue" #carbInput="ngModel"></ion-input>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-item>
              <ion-label position="floating">Protein, gr</ion-label>
              <ion-input ngModel type="number" name="protein" [required]="proteinInput.touched" [min]="minValue" #proteinInput="ngModel"></ion-input>
            </ion-item>
          </ion-col>
        </ion-row>
        <!-- Error message -->
        <ion-row *ngIf="fatInput.hasError('required') && fatInput.touched || carbInput.hasError('required') && carbInput.touched || proteinInput.hasError('required') && proteinInput.touched">
          <ion-col offset-md="4">
            <ion-label color="danger"><ion-icon name="information-circle"></ion-icon>&nbsp;Field must not be empty.</ion-label>
          </ion-col>
        </ion-row>

        <!-- Row 4: - Input serving calories, check calories -->
        <ion-row>
          <ion-col offset-md="1">
            <ion-item>
              <ion-label position="floating">kCalories</ion-label>
              <ion-input ngModel type="number" name="calories" [required]="caloriesInput.touched" [min]="minValue" #caloriesInput="ngModel"></ion-input>
            </ion-item>
          </ion-col>
          <ion-col>
            <ion-card-subtitle>Check calories</ion-card-subtitle>
            <ion-chip outline color="primary">
              <ion-icon name="arrow-back"></ion-icon>
              <ion-label>{{ (fatInput.value * 9 + (carbInput.value + proteinInput.value) * 4) | number: '1.0-0' }}</ion-label>
              <ion-icon name="arrow-forward"></ion-icon>
            </ion-chip>
          </ion-col>
        </ion-row>
        <!-- Error message -->
        <ion-row *ngIf="caloriesInput.hasError('required') && caloriesInput.touched">
          <ion-col offset-md="4">
            <ion-label color="danger"><ion-icon name="information-circle"></ion-icon>&nbsp;Field must not be empty.</ion-label>
          </ion-col>
        </ion-row>

        <div class="buttons_manage_foodItem">
          <ion-button type="Submit" (click)="onSave(loggedUserProfile, f, filterSearchBar.value, 'delete')" [disabled]="filterSearchBar.invalid || filterSearchBar.value === null || f.invalid">Delete</ion-button>
          <ion-button type="Submit" (click)="resetForm()" [disabled]="filterSearchBar.invalid || filterSearchBar.value === null || f.invalid">Reset</ion-button>
          <ion-button type="Submit" (click)="onSave(loggedUserProfile, f, filterSearchBar.value, 'update')" [disabled]="filterSearchBar.invalid || filterSearchBar.value === null || f.invalid">Update</ion-button>
          <ion-button type="Submit" (click)="onSave(loggedUserProfile, f, filterSearchBar.value, 'add')" [disabled]="filterSearchBar.invalid || filterSearchBar.value === null || f.invalid">Add</ion-button>
        </div>

      </ion-grid>
    </ion-card> 
  </form>
</ion-content>

       